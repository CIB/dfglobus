(function(e){function t(t){for(var r,s,o=t[0],u=t[1],c=t[2],l=0,d=[];l<o.length;l++)s=o[l],Object.prototype.hasOwnProperty.call(a,s)&&a[s]&&d.push(a[s][0]),a[s]=0;for(r in u)Object.prototype.hasOwnProperty.call(u,r)&&(e[r]=u[r]);h&&h(t);while(d.length)d.shift()();return i.push.apply(i,c||[]),n()}function n(){for(var e,t=0;t<i.length;t++){for(var n=i[t],r=!0,o=1;o<n.length;o++){var u=n[o];0!==a[u]&&(r=!1)}r&&(i.splice(t--,1),e=s(s.s=n[0]))}return e}var r={},a={app:0},i=[];function s(t){if(r[t])return r[t].exports;var n=r[t]={i:t,l:!1,exports:{}};return e[t].call(n.exports,n,n.exports,s),n.l=!0,n.exports}s.m=e,s.c=r,s.d=function(e,t,n){s.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},s.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},s.t=function(e,t){if(1&t&&(e=s(e)),8&t)return e;if(4&t&&"object"===typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(s.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)s.d(n,r,function(t){return e[t]}.bind(null,r));return n},s.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return s.d(t,"a",t),t},s.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},s.p="/dfglobus/";var o=window["webpackJsonp"]=window["webpackJsonp"]||[],u=o.push.bind(o);o.push=t,o=o.slice();for(var c=0;c<o.length;c++)t(o[c]);var h=u;i.push([0,"chunk-vendors"]),n()})({0:function(e,t,n){e.exports=n("cd49")},"5c0b":function(e,t,n){"use strict";n("9c0c")},6704:function(e,t,n){"use strict";n("9d6b")},8662:function(e,t,n){"use strict";n("ff92")},"9c0c":function(e,t,n){},"9d6b":function(e,t,n){},cd49:function(e,t,n){"use strict";n.r(t);n("e260"),n("e6cf"),n("cca6"),n("a79d");var r=n("2b0e"),a=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{attrs:{id:"app"}},[e.showFileLoader?n("LoadScreen",{on:{start:e.startRendering}}):n("Renderer")],1)},i=[],s=n("d4ec"),o=n("bee2"),u=n("262e"),c=n("2caf"),h=n("9ab4"),l=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"container"},[e._m(0),n("div",{staticClass:"tile"},[n("span",{staticClass:"import-row"},[e._v("Select an elevation file. (region*-el.bmp)")]),n("span",{staticClass:"import-row"},[n("input",{attrs:{type:"file",multiple:""},on:{change:e.updateFiles}})]),n("span",{staticClass:"import-row"},[n("progress",{staticClass:"progressbar",attrs:{max:"100"},domProps:{value:e.heightmapProgress}})])]),n("div",{staticClass:"tile"},[n("span",{staticClass:"import-row"},[e._v("Select a texture. (e.g. region*-detail.bmp)")]),n("span",{staticClass:"import-row"},[n("input",{attrs:{type:"file",multiple:""},on:{change:e.updateTexture}})])])])},d=[function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"tile"},[n("h3",[e._v("dfglobus")]),n("span",[e._v("Ready to import your maps.")]),n("span",{staticClass:"space"}),n("span",{staticClass:"start-button-row"}),n("span",[e._v("Controls:")]),n("span",[e._v("Left mouse button to rotate the view")]),n("span",[e._v("Arrow keys or right mouse button to move")]),n("span",{staticClass:"space"}),n("span",[e._v(" Version 0.1.0 | "),n("a",{attrs:{href:"https://github.com/CIB/dfglobus",target:"_blank"}},[e._v("github")])])])}],p=(n("d3b7"),n("3835")),f=(n("96cf"),n("1da1")),v=(n("99af"),n("fb6a"),n("ddb0"),function(){function e(t,n,r){Object(s["a"])(this,e),this.width=t,this.height=n,this.values=r}return Object(o["a"])(e,[{key:"at",value:function(e,t){return this.values[t*this.width+e]}},{key:"slice",value:function(t,n,r,a){t+r>this.width&&(r=this.width-t),n+a>this.height&&(a=this.height-n);for(var i=[],s=n;s<n+a;s++)i=i.concat(this.values.slice(t+this.width*s,t+r+this.width*s));return new e(r,a,i)}}]),e}()),m=n("b85c"),g=(n("d81d"),n("2ef0")),w=function(){function e(){Object(s["a"])(this,e),this.map={}}return Object(o["a"])(e,[{key:"key",value:function(e,t){return"".concat(e,":").concat(t)}},{key:"has",value:function(e,t){return Object(g["has"])(this.map,this.key(e,t))}},{key:"get",value:function(e,t){return this.map[this.key(e,t)]}},{key:"getOr",value:function(e,t,n){var r=this.get(e,t);return void 0===r?n():r}},{key:"put",value:function(e,t,n){this.map[this.key(e,t)]=n}}]),e}(),b=n("5a89"),y=(n("cfc3"),n("9a8c"),n("a975"),n("735e"),n("c1ac"),n("d139"),n("3a7b"),n("d5d6"),n("82f8"),n("e91f"),n("60bd"),n("5f96"),n("3280"),n("3fcc"),n("ca91"),n("25a1"),n("cd26"),n("3c5d"),n("2954"),n("649e"),n("219c"),n("170b"),n("b39a"),n("72f7"),.15);function x(e,t){var n=[],r=[],a=[],i=[],s=0;function o(t){function o(t){return t/e.width}function u(t){return t/e.height}n.push(t[0],t[1],e.at(t[0],t[1])*y),n.push(t[2],t[3],e.at(t[2],t[3])*y),n.push(t[4],t[5],e.at(t[4],t[5])*y),r.push(0,0,1),r.push(0,0,1),r.push(0,0,1),a.push(o(t[0]),u(t[1]),o(t[2]),u(t[3]),o(t[4]),u(t[5])),i.push(s,s+1,s+2),s+=3}for(var u=0;u<e.width-t;u+=t)for(var c=0;c<e.height-t;c+=t)o([u,c,u+t,c,u,c+t]),o([u+t,c,u+t,c+t,u,c+t]);return{positions:new Float32Array(n),normals:new Float32Array(r),uvs:new Float32Array(a),indices:i}}function k(e,t,n){return O.apply(this,arguments)}function O(){return O=Object(f["a"])(regeneratorRuntime.mark((function e(t,n,r){var a,i,s,o,u,c,h,l,d,p,f,v,m,g,w=arguments;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return a=t.positions,i=t.normals,s=t.uvs,o=t.indices,u=w.length>3&&void 0!==w[3]&&w[3],c=new b["b"],h=new b["m"]({map:n,side:b["e"],alphaTest:0,opacity:1,color:r||"#ffffff",transparent:!1}),l=3,d=3,p=2,c.setAttribute("position",new b["a"](a,l)),c.setAttribute("normal",new b["a"](i,d)),c.setAttribute("uv",new b["a"](s,p)),c.setIndex(o),f=new b["k"](c,h),u&&(v=new b["f"](c),m=new b["h"]({color:0,linewidth:200}),g=new b["i"](v,m),f.add(g)),e.abrupt("return",{mesh:f,resources:[h,n,c]});case 14:case"end":return e.stop()}}),e)}))),O.apply(this,arguments)}var j=n("4721"),R=function(){function e(){Object(s["a"])(this,e),this.canvas=null,this.renderer=null,this.camera=null,this.controls=null,this.scene=null}return Object(o["a"])(e,[{key:"attach",value:function(e){this.canvas=e}},{key:"load",value:function(){var e=Object(f["a"])(regeneratorRuntime.mark((function e(){var t,n,r,a,i,s,o,u,c,h,l=this;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:h=function(e,t,n){var r=16777215,a=1,i=new b["d"](r,a);i.position.set(e,t,n),c.add(i)},t=this.canvas,n=this.renderer=new b["x"]({canvas:t}),n.setPixelRatio(2),r=75,a=1,i=5,s=1e4,o=new b["o"](r,a,i,s),this.camera=o,o.up.set(0,0,1),u=this.controls=new j["a"](o,t),u.enableDamping=!0,u.keyPanSpeed=50,u.dampingFactor=.3,u.maxPolarAngle=Math.PI/2,u.update(),c=this.scene=new b["r"],c.background=new b["c"]("lightblue"),h(-1,2,4),h(1,-1,-2),this.teleport(0,0),this.render(),u.addEventListener("change",(function(){return l.requestRenderIfNotRequested()}));case 24:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"resizeRendererToDisplaySize",value:function(e){var t=e.domElement,n=t.clientWidth,r=t.clientHeight,a=t.width!==n||t.height!==r;return a&&e.setSize(n,r,!1),a}},{key:"render",value:function(){var e=Object(f["a"])(regeneratorRuntime.mark((function e(){var t;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:this.renderRequested=void 0,this.resizeRendererToDisplaySize(this.renderer)&&(t=this.renderer.domElement,this.camera.aspect=t.clientWidth/t.clientHeight,this.camera.updateProjectionMatrix()),this.controls.update(),this.renderer.render(this.scene,this.camera);case 4:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"requestRenderIfNotRequested",value:function(){var e=this;this.renderRequested||(this.renderRequested=!0,requestAnimationFrame((function(){return e.render()})))}},{key:"getPosition",value:function(){return{x:this.controls.target.x,y:-this.controls.target.y,z:this.controls.target.z}}},{key:"setPosition",value:function(e,t,n){this.controls.target.x=e,this.controls.target.y=-t,this.controls.target.z=n,this.requestRenderIfNotRequested()}},{key:"moveZ",value:function(e){this.controls.target.z+=e,this.camera.position.z+=e,this.requestRenderIfNotRequested()}},{key:"teleport",value:function(e,t){this.controls.target.x=e,this.controls.target.y=t,this.controls.target.z=20,this.camera.position.x=e/2,this.camera.position.y=-t/4,this.camera.position.z=e/4,this.requestRenderIfNotRequested()}},{key:"addMesh",value:function(e){this.scene.add(e),this.requestRenderIfNotRequested()}},{key:"removeMesh",value:function(e){this.scene.remove(e),this.requestRenderIfNotRequested()}}]),e}(),P=new R;function M(e){return new Promise((function(t,n){var r=new Image;r.onload=function(){return t(r)},r.onerror=n,r.src=e}))}function _(e,t){var n=document.createElement("canvas");n.width=t.width,n.height=t.height;var r=n.getContext("2d");return r.drawImage(e,t.startX,e.height-t.startY-t.height,t.width,t.height,0,0,t.width,t.height),M(n.toDataURL())}var C=128,I=function(){function e(){Object(s["a"])(this,e),this.loadedChunks=new w}return Object(o["a"])(e,[{key:"renderHeightmap",value:function(){var e=Object(f["a"])(regeneratorRuntime.mark((function e(t){var n,r;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,this.buildMeshFromHeightmap(t,P.texture,256,"#222222");case 2:return n=e.sent,r=n.mesh,n.resources,r.position.z-=20,P.addMesh(r),e.next=9,this.addWorldEdges(0,0,t.width,t.height);case 9:return P.teleport(t.width/2,t.height/2),e.next=12,this.renderDetailLevel(t,1);case 12:return P.removeMesh(r),e.next=15,this.addWaterPlane(0,0,t.width,t.height);case 15:case"end":return e.stop()}}),e,this)})));function t(t){return e.apply(this,arguments)}return t}()},{key:"addWorldEdges",value:function(){var e=Object(f["a"])(regeneratorRuntime.mark((function e(t,n,r,a){var i,s,o,u,c,h,l,d;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return i=new b["p"](r-t,200,4,4),s=new b["k"](i,new b["l"]({color:"#222222",opacity:1,transparent:!0,side:b["e"]})),s.position.set(r/2,0,-85.2),s.rotation.set(Math.PI/2,0,0),P.addMesh(s),o=new b["p"](r-t,200,4,4),u=new b["k"](o,new b["l"]({color:"#222222",opacity:1,transparent:!1,side:b["e"]})),u.position.set(r/2,a,-85.2),u.rotation.set(Math.PI/2,0,0),P.addMesh(u),c=new b["p"](a-n,200,4,4),h=new b["k"](c,new b["l"]({color:"#222222",opacity:1,transparent:!1,side:b["e"]})),h.position.set(0,a/2,-85.2),h.rotation.set(Math.PI/2,Math.PI/2,0),P.addMesh(h),l=new b["p"](a-n,200,4,4),d=new b["k"](l,new b["l"]({color:"#222222",opacity:1,transparent:!1,side:b["e"]})),d.position.set(r,a/2,-85.2),d.rotation.set(Math.PI/2,Math.PI/2,0),P.addMesh(d),e.abrupt("return",[{mesh:s,resources:[i]},{mesh:u,resources:[o]}]);case 21:case"end":return e.stop()}}),e)})));function t(t,n,r,a){return e.apply(this,arguments)}return t}()},{key:"addWaterPlane",value:function(){var e=Object(f["a"])(regeneratorRuntime.mark((function e(t,n,r,a){var i,s;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:i=new b["p"](r-t,a-n,4,4),s=new b["k"](i,new b["l"]({color:"#0000ff",opacity:.5,transparent:!0,side:b["e"]})),s.position.set(r/2,a/2,14.8),P.addMesh(s);case 4:case"end":return e.stop()}}),e)})));function t(t,n,r,a){return e.apply(this,arguments)}return t}()},{key:"buildMeshFromHeightmap",value:function(){var e=Object(f["a"])(regeneratorRuntime.mark((function e(t,n,r,a){var i,s;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return i=new b["u"](n),i.needsUpdate=!0,i.magFilter=b["n"],i.minFilter=b["n"],s=x(t,r),e.abrupt("return",k(s,i,a));case 6:case"end":return e.stop()}}),e)})));function t(t,n,r,a){return e.apply(this,arguments)}return t}()},{key:"renderDetailLevel",value:function(){var e=Object(f["a"])(regeneratorRuntime.mark((function e(t,n){var r,a,i,s,o,u,c,h,l,d,p,f,v;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:r=0;case 1:if(!(r<t.width/C)){e.next=29;break}a=0;case 3:if(!(a<t.height/C)){e.next=26;break}return i=this.loadedChunks.get(r,a),s=t.slice(r*C,a*C,C+1,C+1),o=Math.min(C,t.width-r*C),u=Math.min(C,t.height-a*C),e.next=10,_(P.texture,{startX:(r*C+1)*P.texture.width/t.width,startY:(a*C+1)*P.texture.height/t.height,width:o*P.texture.width/t.width,height:u*P.texture.height/t.height});case 10:return c=e.sent,e.next=13,this.buildMeshFromHeightmap(s,c,n);case 13:if(h=e.sent,l=h.mesh,d=h.resources,l.position.x=r*C,l.position.y=a*C,P.addMesh(l),i){P.removeMesh(i.mesh),p=Object(m["a"])(i.resources);try{for(p.s();!(f=p.n()).done;)v=f.value,v.dispose()}catch(g){p.e(g)}finally{p.f()}}return this.loadedChunks.put(r,a,{mesh:l,resources:d}),e.next=23,new Promise((function(e){return setTimeout(e,n<16?100:2)}));case 23:a++,e.next=3;break;case 26:r++,e.next=1;break;case 29:case"end":return e.stop()}}),e,this)})));function t(t,n){return e.apply(this,arguments)}return t}()}]),e}(),q=new I,F=n("60a3"),S=function(e){Object(u["a"])(n,e);var t=Object(c["a"])(n);function n(){var e;return Object(s["a"])(this,n),e=t.apply(this,arguments),e.heightmapProgress=0,e}return Object(o["a"])(n,[{key:"start",value:function(){var e=Object(f["a"])(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return this.$emit("start"),e.next=3,new Promise((function(e){return setTimeout(e,100)}));case 3:return e.next=5,P.load();case 5:q.renderHeightmap(this.heightmap);case 6:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"updateFiles",value:function(){var e=Object(f["a"])(regeneratorRuntime.mark((function e(t){var n,r,a,i,s,o,u,c,h,l,d,f,m,w,b,y;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return n=function(e){return new Promise((function(t){return setTimeout(t,e)}))},r=t.target.files,a=new FileReader,this.heightmapProgress=1,a.readAsDataURL(r[0]),e.next=7,new Promise((function(e,t){a.onload=function(){return e(a.result)},a.onerror=t}));case 7:return i=e.sent,e.next=10,M(i);case 10:return s=e.sent,this.heightmapProgress=10,e.next=14,n(10);case 14:return o=document.createElement("canvas"),o.width=s.width,o.height=s.height,u=o.getContext("2d"),u.drawImage(s,0,0),this.heightmapProgress=20,e.next=22,n(10);case 22:c=u.getImageData(0,0,s.width,s.height).data,h=80/(s.width*s.height),l=[],d=Object(g["chunk"])(c,4),f=0;case 27:if(!(f<d.length)){e.next=37;break}if(m=Object(p["a"])(d[f],3),w=m[0],b=m[1],y=m[2],w||b?l.push(1.35*w||b):l.push(y),f%1e5!==0){e.next=34;break}return this.heightmapProgress+=1e5*h,e.next=34,n(10);case 34:f++,e.next=27;break;case 37:this.heightmapProgress=100,l=Object(g["flatten"])(Object(g["reverse"])(Object(g["chunk"])(l,s.width))),this.heightmap=new v(s.width,s.height,l),this.texture&&this.start();case 41:case"end":return e.stop()}}),e,this)})));function t(t){return e.apply(this,arguments)}return t}()},{key:"updateTexture",value:function(){var e=Object(f["a"])(regeneratorRuntime.mark((function e(t){var n,r,a,i,s;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return i=function(e){return new Promise((function(t,n){var r=new Image;r.onload=function(){return t(r)},r.onerror=n,r.src=e}))},n=t.target.files,r=new FileReader,r.readAsDataURL(n[0]),e.next=6,new Promise((function(e,t){r.onload=function(){return e(r.result)},r.onerror=t}));case 6:return a=e.sent,e.next=9,i(a);case 9:s=e.sent,P.texture=s,this.texture=s,this.heightmap&&this.start();case 13:case"end":return e.stop()}}),e,this)})));function t(t){return e.apply(this,arguments)}return t}()}]),n}(F["c"]);S=Object(h["a"])([F["a"]],S);var z=S,L=z,A=(n("8662"),n("2877")),E=Object(A["a"])(L,l,d,!1,null,"79aecb3a",null),T=E.exports,D=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("canvas",{attrs:{id:"rendererCanvas"}})},H=[],N=function(e){Object(u["a"])(n,e);var t=Object(c["a"])(n);function n(){return Object(s["a"])(this,n),t.apply(this,arguments)}return Object(o["a"])(n,[{key:"mounted",value:function(){var e=document.querySelector("#rendererCanvas");P.attach(e)}}]),n}(F["c"]);Object(h["a"])([Object(F["b"])()],N.prototype,"msg",void 0),N=Object(h["a"])([F["a"]],N);var W=N,$=W,U=(n("6704"),Object(A["a"])($,D,H,!1,null,"61d60011",null)),J=U.exports,X=function(e){Object(u["a"])(n,e);var t=Object(c["a"])(n);function n(){var e;return Object(s["a"])(this,n),e=t.apply(this,arguments),e.showFileLoader=!0,e}return Object(o["a"])(n,[{key:"startRendering",value:function(){this.showFileLoader=!1}}]),n}(F["c"]);X=Object(h["a"])([Object(F["a"])({components:{Renderer:J,LoadScreen:T}})],X);var Y=X,B=Y,V=(n("5c0b"),Object(A["a"])(B,a,i,!1,null,null,null)),Z=V.exports;r["a"].config.productionTip=!1,new r["a"]({render:function(e){return e(Z)}}).$mount("#app")},ff92:function(e,t,n){}});
//# sourceMappingURL=app.532d6722.js.map